<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Qu√† t·∫∑ng Gi√°ng Sinh üéÅ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <style>
        video { transform: scaleX(-1); object-fit: cover; }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 to-red-100 min-h-screen flex flex-col items-center justify-center p-4 font-sans">

    <div class="bg-white p-5 rounded-3xl shadow-2xl w-full max-w-sm text-center border-4 border-white">
        <h1 class="text-xl font-extrabold text-pink-600 mb-2">üéÅ NHI·ªÜM V·ª§ NH·∫¨N QU√Ä</h1>
        <p class="text-xs text-gray-500 mb-4">C∆∞·ªùi nhe rƒÉng (üò¨) + C∆∞·ªùi ra ti·∫øng (Ha ha!)</p>
        
        <div class="relative rounded-2xl overflow-hidden bg-black aspect-[3/4] mb-4 shadow-inner">
            <video id="video" class="w-full h-full object-cover" autoplay muted playsinline webkit-playsinline></video>
            
            <canvas id="overlay" class="absolute top-0 left-0 w-full h-full"></canvas>

            <div id="loader" class="absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-90 text-white p-4 z-20">
                <div class="animate-spin rounded-full h-8 w-8 border-t-2 border-pink-500 mb-3"></div>
                <p id="loader-text" class="text-center text-xs">ƒêang t·∫£i AI...</p>
                <div id="error-msg" class="hidden text-red-400 text-xs mt-2 border border-red-500 p-2 rounded"></div>
                <button id="btn-skip" class="hidden mt-4 px-3 py-1 bg-gray-700 rounded text-xs hover:bg-gray-600" onclick="skipToGift()">
                    B·ªè qua & Nh·∫≠n qu√† lu√¥n
                </button>
            </div>

            <div class="absolute bottom-2 left-2 right-2 bg-black bg-opacity-60 rounded-lg p-2 text-white text-[10px] flex justify-between z-10">
                <span>C∆∞·ªùi: <b id="d-smile" class="text-red-300">0%</b></span>
                <span>Mi·ªáng: <b id="d-mouth" class="text-red-300">ƒê√≥ng</b></span>
                <span>√Çm l∆∞·ª£ng: <b id="d-vol" class="text-red-300">0</b></span>
            </div>
        </div>

        <div id="status" class="text-base font-bold text-gray-700 mb-2 min-h-[1.5rem]">
            ƒêang kh·ªüi ƒë·ªông...
        </div>
        
        <div class="w-full bg-gray-200 rounded-full h-3 mb-4">
            <div id="progress" class="bg-gradient-to-r from-pink-400 to-red-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
        </div>
        
        <button id="btn-start" class="hidden w-full py-3 bg-pink-500 text-white rounded-xl font-bold shadow-lg active:scale-95" onclick="startApp()">
            B·∫ÆT ƒê·∫¶U üì∏
        </button>
    </div>

    <script>
        const VOUCHER_LINK = "https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExdWYxbWJnbzA4MG4xdzZ1aTl5ajkwZzRzcmE2a3cxamNxZWl2cXhxaCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/gNke2UrUTopOg/giphy.gif"; 
        
        // C·∫§U H√åNH ƒê·ªò KH√ì
        const CONFIG = {
            smile: 0.7,      // 70% ƒë·ªô c∆∞·ªùi
            mouth: 0.1,      // ƒê·ªô m·ªü mi·ªáng (tƒÉng n·∫øu kh√≥, gi·∫£m n·∫øu d·ªÖ)
            volume: 15       // ƒê·ªô ·ªìn
        };

        const els = {
            video: document.getElementById('video'),
            loader: document.getElementById('loader'),
            loaderText: document.getElementById('loader-text'),
            errorMsg: document.getElementById('error-msg'),
            btnSkip: document.getElementById('btn-skip'),
            status: document.getElementById('status'),
            progress: document.getElementById('progress'),
            btnStart: document.getElementById('btn-start'),
            dSmile: document.getElementById('d-smile'),
            dMouth: document.getElementById('d-mouth'),
            dVol: document.getElementById('d-vol')
        };

        let audioContext, analyser, microphone;
        let isRunning = false;

        // 1. T·∫£i Model (D√πng link raw github ·ªïn ƒë·ªãnh h∆°n)
        async function loadModels() {
            try {
                // Link weights tr·ª±c ti·∫øp t·ª´ Github
                const MODEL
